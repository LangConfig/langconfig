/**
 * Copyright (c) 2025 Cade Russell (Ghost Peony)
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

/**
 * Files Library Tab
 *
 * Browse all files generated by agents across all projects and workflows.
 * Supports tree view and list view with search, filter, and file actions.
 */

import { useState, useEffect, useMemo } from 'react';
import { Download, Trash2, Search, FolderOpen, ChevronRight, ChevronDown, List, TreeDeciduous, Eye, RefreshCw } from 'lucide-react';
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';

interface FileWithContext {
  filename: string;
  path: string;
  full_path: string;
  project_id: number | null;
  workflow_id: number | null;
  task_id: number | null;
  size_bytes: number;
  size_human: string;
  modified_at: string;
  extension: string;
}

interface FileContent {
  filename: string;
  content: string | null;
  mime_type: string;
  is_binary: boolean;
  truncated: boolean;
  size_bytes: number;
}

// File type icons
const getFileIcon = (extension: string): string => {
  const ext = extension.toLowerCase().replace('.', '');
  const icons: Record<string, string> = {
    md: 'üìù',
    txt: 'üìÑ',
    json: 'üìä',
    csv: 'üìä',
    py: 'üêç',
    js: 'üíõ',
    ts: 'üíô',
    tsx: 'üíô',
    jsx: 'üíõ',
    html: 'üåê',
    css: 'üé®',
    sql: 'üóÉÔ∏è',
    yaml: '‚öôÔ∏è',
    yml: '‚öôÔ∏è',
    xml: 'üìã',
    log: 'üìú',
    pdf: 'üìï',
    png: 'üñºÔ∏è',
    jpg: 'üñºÔ∏è',
    jpeg: 'üñºÔ∏è',
    gif: 'üñºÔ∏è',
    svg: 'üé®',
  };
  return icons[ext] || 'üìÑ';
};

// Get language for syntax highlighting
const getLanguage = (extension: string): string => {
  const ext = extension.toLowerCase().replace('.', '');
  const languages: Record<string, string> = {
    py: 'python',
    js: 'javascript',
    ts: 'typescript',
    tsx: 'tsx',
    jsx: 'jsx',
    json: 'json',
    html: 'html',
    css: 'css',
    sql: 'sql',
    yaml: 'yaml',
    yml: 'yaml',
    xml: 'xml',
    sh: 'bash',
    bash: 'bash',
  };
  return languages[ext] || 'text';
};

// Tree node structure
interface TreeNode {
  name: string;
  path: string;
  type: 'project' | 'workflow' | 'task' | 'file';
  id?: number | null;
  file?: FileWithContext;
  children: TreeNode[];
  expanded?: boolean;
}

export default function FilesLibraryTab() {
  const [files, setFiles] = useState<FileWithContext[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // View state
  const [viewMode, setViewMode] = useState<'tree' | 'list'>('tree');
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState<'name' | 'date' | 'size'>('date');
  const [sortDesc, setSortDesc] = useState(true);

  // Tree state
  const [expandedNodes, setExpandedNodes] = useState<Set<string>>(new Set());

  // Preview state
  const [selectedFile, setSelectedFile] = useState<FileWithContext | null>(null);
  const [fileContent, setFileContent] = useState<FileContent | null>(null);
  const [contentLoading, setContentLoading] = useState(false);
  const [previewOpen, setPreviewOpen] = useState(false);

  // Delete confirmation
  const [deleteConfirm, setDeleteConfirm] = useState<FileWithContext | null>(null);

  // Fetch all files
  useEffect(() => {
    fetchFiles();
  }, []);

  const fetchFiles = async () => {
    setLoading(true);
    setError(null);

    try {
      const response = await fetch('/api/workspace/files');
      if (!response.ok) throw new Error('Failed to fetch files');
      const data = await response.json();
      setFiles(data.files || []);
    } catch (err) {
      console.error('Error fetching files:', err);
      setError(err instanceof Error ? err.message : 'Failed to load files');
    } finally {
      setLoading(false);
    }
  };

  // Fetch file content for preview
  const fetchFileContent = async (file: FileWithContext) => {
    if (!file.task_id) return;

    setContentLoading(true);
    try {
      const response = await fetch(`/api/workspace/tasks/${file.task_id}/files/${file.filename}/content`);
      if (!response.ok) throw new Error('Failed to fetch content');
      const data = await response.json();
      setFileContent(data);
    } catch (error) {
      console.error('Error fetching file content:', error);
      setFileContent(null);
    } finally {
      setContentLoading(false);
    }
  };

  // Handle file preview
  const handlePreview = (file: FileWithContext) => {
    setSelectedFile(file);
    setPreviewOpen(true);
    fetchFileContent(file);
  };

  // Handle download
  const handleDownload = (file: FileWithContext) => {
    if (!file.task_id) return;
    window.open(`/api/workspace/tasks/${file.task_id}/files/${file.filename}`, '_blank');
  };

  // Handle delete
  const handleDelete = async (file: FileWithContext) => {
    if (!file.task_id) return;

    try {
      const response = await fetch(`/api/workspace/tasks/${file.task_id}/files/${file.filename}`, {
        method: 'DELETE'
      });

      if (!response.ok) throw new Error('Failed to delete file');

      // Refresh files
      await fetchFiles();
      setDeleteConfirm(null);

      // Clear preview if deleted file was selected
      if (selectedFile?.path === file.path) {
        setSelectedFile(null);
        setFileContent(null);
        setPreviewOpen(false);
      }
    } catch (error) {
      console.error('Error deleting file:', error);
      alert('Failed to delete file.');
    }
  };

  // Filter and sort files
  const filteredFiles = useMemo(() => {
    let result = [...files];

    // Filter by search
    if (searchQuery.trim()) {
      const search = searchQuery.toLowerCase();
      result = result.filter(f => f.filename.toLowerCase().includes(search));
    }

    // Sort
    result.sort((a, b) => {
      let comparison = 0;
      switch (sortBy) {
        case 'name':
          comparison = a.filename.localeCompare(b.filename);
          break;
        case 'date':
          comparison = new Date(a.modified_at).getTime() - new Date(b.modified_at).getTime();
          break;
        case 'size':
          comparison = a.size_bytes - b.size_bytes;
          break;
      }
      return sortDesc ? -comparison : comparison;
    });

    return result;
  }, [files, searchQuery, sortBy, sortDesc]);

  // Build tree structure
  const treeData = useMemo(() => {
    const root: TreeNode[] = [];
    const projectMap = new Map<string, TreeNode>();
    const workflowMap = new Map<string, TreeNode>();
    const taskMap = new Map<string, TreeNode>();

    filteredFiles.forEach(file => {
      const projectKey = file.project_id !== null ? `project_${file.project_id}` : 'standalone';
      const workflowKey = file.workflow_id !== null ? `${projectKey}/workflow_${file.workflow_id}` : null;
      const taskKey = file.task_id !== null && workflowKey ? `${workflowKey}/task_${file.task_id}` : null;

      // Create/get project node
      if (!projectMap.has(projectKey)) {
        const projectNode: TreeNode = {
          name: file.project_id !== null ? `Project ${file.project_id}` : 'Standalone & Default',
          path: projectKey,
          type: 'project',
          id: file.project_id,
          children: [],
          expanded: expandedNodes.has(projectKey)
        };
        projectMap.set(projectKey, projectNode);
        root.push(projectNode);
      }

      if (!workflowKey || !taskKey) {
        // File in default directory (no workflow/task)
        const projectNode = projectMap.get(projectKey)!;
        projectNode.children.push({
          name: file.filename,
          path: file.path,
          type: 'file',
          file,
          children: []
        });
        return;
      }

      // Create/get workflow node
      if (!workflowMap.has(workflowKey)) {
        const workflowNode: TreeNode = {
          name: `Workflow ${file.workflow_id}`,
          path: workflowKey,
          type: 'workflow',
          id: file.workflow_id,
          children: [],
          expanded: expandedNodes.has(workflowKey)
        };
        workflowMap.set(workflowKey, workflowNode);
        projectMap.get(projectKey)!.children.push(workflowNode);
      }

      // Create/get task node
      if (!taskMap.has(taskKey)) {
        const taskNode: TreeNode = {
          name: `Task #${file.task_id}`,
          path: taskKey,
          type: 'task',
          id: file.task_id,
          children: [],
          expanded: expandedNodes.has(taskKey)
        };
        taskMap.set(taskKey, taskNode);
        workflowMap.get(workflowKey)!.children.push(taskNode);
      }

      // Add file to task
      taskMap.get(taskKey)!.children.push({
        name: file.filename,
        path: file.path,
        type: 'file',
        file,
        children: []
      });
    });

    return root;
  }, [filteredFiles, expandedNodes]);

  // Toggle tree node expansion
  const toggleNode = (path: string) => {
    setExpandedNodes(prev => {
      const next = new Set(prev);
      if (next.has(path)) {
        next.delete(path);
      } else {
        next.add(path);
      }
      return next;
    });
  };

  // Render tree node
  const renderTreeNode = (node: TreeNode, depth: number = 0): JSX.Element => {
    const isExpanded = expandedNodes.has(node.path);
    const hasChildren = node.children.length > 0;
    const paddingLeft = depth * 20;

    if (node.type === 'file' && node.file) {
      return (
        <div
          key={node.path}
          className={`flex items-center gap-2 px-3 py-2 hover:bg-gray-50 dark:hover:bg-white/5 cursor-pointer group ${
            selectedFile?.path === node.path ? 'bg-primary/10' : ''
          }`}
          style={{ paddingLeft: paddingLeft + 28 }}
          onClick={() => handlePreview(node.file!)}
        >
          <span className="text-base">{getFileIcon(node.file.extension)}</span>
          <span className="flex-1 text-sm text-gray-900 dark:text-white truncate">{node.name}</span>
          <span className="text-xs text-gray-500 dark:text-text-muted">{node.file.size_human}</span>
          <div className="hidden group-hover:flex items-center gap-1">
            <button
              onClick={(e) => { e.stopPropagation(); handleDownload(node.file!); }}
              className="p-1 rounded hover:bg-gray-200 dark:hover:bg-white/10"
              title="Download"
            >
              <Download className="w-3.5 h-3.5 text-gray-500" />
            </button>
            <button
              onClick={(e) => { e.stopPropagation(); setDeleteConfirm(node.file!); }}
              className="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30"
              title="Delete"
            >
              <Trash2 className="w-3.5 h-3.5 text-red-500" />
            </button>
          </div>
        </div>
      );
    }

    const icon = node.type === 'project' ? 'üìÅ' : node.type === 'workflow' ? 'üîÑ' : 'üìã';
    const fileCount = countFiles(node);

    return (
      <div key={node.path}>
        <div
          className="flex items-center gap-2 px-3 py-2 hover:bg-gray-50 dark:hover:bg-white/5 cursor-pointer"
          style={{ paddingLeft }}
          onClick={() => toggleNode(node.path)}
        >
          {hasChildren ? (
            isExpanded ? (
              <ChevronDown className="w-4 h-4 text-gray-400" />
            ) : (
              <ChevronRight className="w-4 h-4 text-gray-400" />
            )
          ) : (
            <div className="w-4" />
          )}
          <span className="text-base">{icon}</span>
          <span className="flex-1 text-sm font-medium text-gray-900 dark:text-white">{node.name}</span>
          <span className="text-xs text-gray-500 dark:text-text-muted">
            {fileCount} file{fileCount !== 1 ? 's' : ''}
          </span>
        </div>
        {isExpanded && node.children.map(child => renderTreeNode(child, depth + 1))}
      </div>
    );
  };

  // Count files recursively
  const countFiles = (node: TreeNode): number => {
    if (node.type === 'file') return 1;
    return node.children.reduce((sum, child) => sum + countFiles(child), 0);
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4" style={{ borderColor: 'var(--color-primary)' }}></div>
          <p className="text-sm text-gray-600 dark:text-text-muted">Loading files...</p>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex flex-col items-center justify-center h-full text-center">
        <FolderOpen className="w-16 h-16 text-red-300 dark:text-red-900/30 mb-4" />
        <p className="text-lg font-medium text-red-600 dark:text-red-400">Failed to load files</p>
        <p className="text-sm text-gray-500 dark:text-text-muted/70 mt-2">{error}</p>
        <button
          onClick={fetchFiles}
          className="mt-4 px-4 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 transition-colors text-sm font-medium flex items-center gap-2"
          style={{ color: 'var(--color-primary)' }}
        >
          <RefreshCw className="w-4 h-4" />
          Retry
        </button>
      </div>
    );
  }

  if (files.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center h-full text-center">
        <FolderOpen className="w-16 h-16 text-gray-300 dark:text-text-muted/30 mb-4" />
        <p className="text-lg font-medium text-gray-600 dark:text-text-muted">No files yet</p>
        <p className="text-sm text-gray-500 dark:text-text-muted/70 mt-2">
          Files created by agents during workflow execution will appear here.
        </p>
      </div>
    );
  }

  return (
    <div className="h-full flex flex-col">
      {/* Toolbar */}
      <div className="flex-shrink-0 flex items-center justify-between gap-4 p-4 border-b border-gray-200 dark:border-border-dark">
        <div className="flex items-center gap-3">
          {/* Search */}
          <div className="relative">
            <Search className="absolute left-2.5 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              placeholder="Search files..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-8 pr-3 py-1.5 text-sm rounded-lg border border-gray-200 dark:border-border-dark bg-white dark:bg-panel-dark w-64 focus:outline-none focus:ring-2 focus:ring-primary/50"
            />
          </div>

          {/* Sort */}
          <select
            value={`${sortBy}-${sortDesc ? 'desc' : 'asc'}`}
            onChange={(e) => {
              const [sort, order] = e.target.value.split('-');
              setSortBy(sort as 'name' | 'date' | 'size');
              setSortDesc(order === 'desc');
            }}
            className="px-3 py-1.5 text-sm rounded-lg border border-gray-200 dark:border-border-dark bg-white dark:bg-panel-dark focus:outline-none focus:ring-2 focus:ring-primary/50"
          >
            <option value="date-desc">Newest First</option>
            <option value="date-asc">Oldest First</option>
            <option value="name-asc">Name A-Z</option>
            <option value="name-desc">Name Z-A</option>
            <option value="size-desc">Largest First</option>
            <option value="size-asc">Smallest First</option>
          </select>
        </div>

        <div className="flex items-center gap-2">
          {/* Refresh */}
          <button
            onClick={fetchFiles}
            className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
            title="Refresh"
          >
            <RefreshCw className="w-4 h-4 text-gray-600 dark:text-text-muted" />
          </button>

          {/* View Toggle */}
          <div className="flex border border-gray-200 dark:border-border-dark rounded-lg overflow-hidden">
            <button
              onClick={() => setViewMode('tree')}
              className={`px-3 py-1.5 text-sm flex items-center gap-1.5 ${
                viewMode === 'tree'
                  ? 'bg-primary/10 text-primary'
                  : 'text-gray-600 dark:text-text-muted hover:bg-gray-50 dark:hover:bg-white/5'
              }`}
              title="Tree View"
            >
              <TreeDeciduous className="w-4 h-4" />
              Tree
            </button>
            <button
              onClick={() => setViewMode('list')}
              className={`px-3 py-1.5 text-sm flex items-center gap-1.5 border-l border-gray-200 dark:border-border-dark ${
                viewMode === 'list'
                  ? 'bg-primary/10 text-primary'
                  : 'text-gray-600 dark:text-text-muted hover:bg-gray-50 dark:hover:bg-white/5'
              }`}
              title="List View"
            >
              <List className="w-4 h-4" />
              List
            </button>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* File Browser */}
        <div className={`${previewOpen ? 'w-1/2' : 'flex-1'} overflow-auto border-r border-gray-200 dark:border-border-dark`}>
          {viewMode === 'tree' ? (
            <div className="py-2">
              {treeData.map(node => renderTreeNode(node))}
            </div>
          ) : (
            <table className="w-full">
              <thead className="bg-gray-50 dark:bg-white/5 sticky top-0">
                <tr>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-600 dark:text-text-muted uppercase">Name</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-600 dark:text-text-muted uppercase">Location</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-600 dark:text-text-muted uppercase">Size</th>
                  <th className="text-left px-4 py-2 text-xs font-semibold text-gray-600 dark:text-text-muted uppercase">Modified</th>
                  <th className="w-24"></th>
                </tr>
              </thead>
              <tbody>
                {filteredFiles.map((file, index) => (
                  <tr
                    key={index}
                    className={`border-b border-gray-100 dark:border-border-dark hover:bg-gray-50 dark:hover:bg-white/5 cursor-pointer ${
                      selectedFile?.path === file.path ? 'bg-primary/10' : ''
                    }`}
                    onClick={() => handlePreview(file)}
                  >
                    <td className="px-4 py-2.5">
                      <div className="flex items-center gap-2">
                        <span className="text-base">{getFileIcon(file.extension)}</span>
                        <span className="text-sm font-medium text-gray-900 dark:text-white">{file.filename}</span>
                      </div>
                    </td>
                    <td className="px-4 py-2.5">
                      <span className="text-xs text-gray-500 dark:text-text-muted">
                        {file.project_id !== null ? `Project ${file.project_id}` : 'Default'}{' '}
                        {file.workflow_id !== null ? `‚Ä∫ Workflow ${file.workflow_id}` : ''}{' '}
                        {file.task_id !== null ? `‚Ä∫ Task ${file.task_id}` : ''}
                      </span>
                    </td>
                    <td className="px-4 py-2.5 text-sm text-gray-600 dark:text-text-muted">{file.size_human}</td>
                    <td className="px-4 py-2.5 text-sm text-gray-600 dark:text-text-muted">
                      {new Date(file.modified_at).toLocaleDateString()}
                    </td>
                    <td className="px-4 py-2.5">
                      <div className="flex items-center gap-1 justify-end">
                        <button
                          onClick={(e) => { e.stopPropagation(); handleDownload(file); }}
                          className="p-1.5 rounded hover:bg-gray-200 dark:hover:bg-white/10"
                          title="Download"
                        >
                          <Download className="w-4 h-4 text-gray-500" />
                        </button>
                        <button
                          onClick={(e) => { e.stopPropagation(); setDeleteConfirm(file); }}
                          className="p-1.5 rounded hover:bg-red-100 dark:hover:bg-red-900/30"
                          title="Delete"
                        >
                          <Trash2 className="w-4 h-4 text-red-500" />
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}
        </div>

        {/* Preview Panel */}
        {previewOpen && selectedFile && (
          <div className="w-1/2 flex flex-col overflow-hidden">
            {/* Preview Header */}
            <div className="flex-shrink-0 flex items-center justify-between p-4 border-b border-gray-200 dark:border-border-dark">
              <div className="flex items-center gap-2 min-w-0">
                <span className="text-xl">{getFileIcon(selectedFile.extension)}</span>
                <h3 className="font-semibold text-gray-900 dark:text-white truncate">{selectedFile.filename}</h3>
              </div>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => handleDownload(selectedFile)}
                  className="p-1.5 rounded hover:bg-gray-100 dark:hover:bg-white/10"
                  title="Download"
                >
                  <Download className="w-4 h-4 text-gray-600 dark:text-text-muted" />
                </button>
                <button
                  onClick={() => { setPreviewOpen(false); setSelectedFile(null); setFileContent(null); }}
                  className="p-1.5 rounded hover:bg-gray-100 dark:hover:bg-white/10"
                  title="Close preview"
                >
                  <span className="text-xl text-gray-400">√ó</span>
                </button>
              </div>
            </div>

            {/* Preview Content */}
            <div className="flex-1 overflow-auto p-4 bg-gray-50 dark:bg-black/20">
              {contentLoading ? (
                <div className="flex items-center justify-center h-full">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2" style={{ borderColor: 'var(--color-primary)' }}></div>
                </div>
              ) : fileContent?.is_binary ? (
                <div className="flex flex-col items-center justify-center h-full text-center">
                  <span className="text-4xl mb-3">{getFileIcon(selectedFile.extension)}</span>
                  <p className="text-gray-600 dark:text-text-muted">Binary file - preview not available</p>
                  <p className="text-sm text-gray-500 dark:text-text-muted/70 mt-1">{selectedFile.size_human}</p>
                  <button
                    onClick={() => handleDownload(selectedFile)}
                    className="mt-4 px-4 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 transition-colors text-sm font-medium flex items-center gap-2"
                    style={{ color: 'var(--color-primary)' }}
                  >
                    <Download className="w-4 h-4" />
                    Download to view
                  </button>
                </div>
              ) : fileContent?.content ? (
                <div>
                  {selectedFile.extension === '.md' ? (
                    <div className="prose prose-sm dark:prose-invert max-w-none">
                      <ReactMarkdown>{fileContent.content}</ReactMarkdown>
                    </div>
                  ) : ['json', 'py', 'js', 'ts', 'tsx', 'jsx', 'html', 'css', 'sql', 'yaml', 'yml', 'xml', 'sh', 'bash'].includes(selectedFile.extension.replace('.', '').toLowerCase()) ? (
                    <SyntaxHighlighter
                      language={getLanguage(selectedFile.extension)}
                      style={oneDark}
                      customStyle={{ margin: 0, borderRadius: '0.5rem', fontSize: '0.8rem' }}
                      showLineNumbers
                    >
                      {fileContent.content}
                    </SyntaxHighlighter>
                  ) : (
                    <pre className="text-sm whitespace-pre-wrap break-words font-mono text-gray-800 dark:text-gray-200">
                      {fileContent.content}
                    </pre>
                  )}
                  {fileContent.truncated && (
                    <div className="mt-4 p-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800/30 rounded text-sm text-yellow-800 dark:text-yellow-200">
                      File content truncated. Download to see full content.
                    </div>
                  )}
                </div>
              ) : (
                <div className="flex items-center justify-center h-full text-gray-500 dark:text-text-muted">
                  Unable to load file content
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      {/* Delete Confirmation Modal */}
      {deleteConfirm && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
          <div className="bg-white dark:bg-panel-dark rounded-lg p-6 max-w-md mx-4 shadow-xl">
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-2">Delete File?</h3>
            <p className="text-sm text-gray-600 dark:text-text-muted mb-4">
              Are you sure you want to delete "{deleteConfirm.filename}"? This action cannot be undone.
            </p>
            <div className="flex justify-end gap-3">
              <button
                onClick={() => setDeleteConfirm(null)}
                className="px-4 py-2 text-sm rounded-lg border border-gray-200 dark:border-border-dark hover:bg-gray-50 dark:hover:bg-white/5"
              >
                Cancel
              </button>
              <button
                onClick={() => handleDelete(deleteConfirm)}
                className="px-4 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
